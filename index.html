<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Signature</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f9;
        }

        .container {
            text-align: center;
            width: 100%;
            max-width: 600px;
        }

        canvas {
            border: 2px solid #000;
            background-color: white;
            margin-bottom: 10px;
            width: 100%;
            height: auto;
        }

        .controls {
            margin-top: 10px;
        }

        .controls select, .controls button {
            padding: 5px 10px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        .btn-clear {
            background-color: #ff4747;
            color: white;
            border: none;
        }

        .btn-save {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: not-allowed;
        }

        .btn-save.enabled {
            cursor: pointer;
        }

        #message {
            margin-top: 10px;
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>TTD Digital</h1>
    <canvas id="signatureCanvas"></canvas>
    <div class="controls">
        <label for="colorPicker">Pilih Warna:</label>
        <select id="colorPicker">
            <option value="#000000">Hitam</option>
            <option value="#ff0000">Merah</option>
            <option value="#0000ff">Biru</option>
            <option value="#00ff00">Hijau</option>
        </select>

        <button class="btn-clear" onclick="clearCanvas()">Bersihkan</button>
        <button id="saveButton" class="btn-save" onclick="saveSignature()" disabled>Simpan</button>
    </div>
    
    <h2>@copyright Imandrifatur 2024</h2>

    <div id="message"></div>
</div>

<script>
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    const saveButton = document.getElementById('saveButton');

    // Set the canvas size dynamically based on window size
    function resizeCanvas() {
        canvas.width = window.innerWidth * 0.8;  // 80% of the window width
        canvas.height = window.innerHeight * 0.4; // 40% of the window height
    }

    // Set the default pen color
    let penColor = document.getElementById('colorPicker').value;

    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    // Call resizeCanvas on window resize
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();  // Call once on page load

    // Function to start drawing for mouse or touch
    function startDrawing(e) {
        isDrawing = true;
        lastX = e.offsetX || e.touches[0].clientX - canvas.offsetLeft;
        lastY = e.offsetY || e.touches[0].clientY - canvas.offsetTop;
    }

    // Function to stop drawing
    function stopDrawing() {
        isDrawing = false;
    }

    // Function to draw the signature for mouse or touch
    function draw(e) {
        if (!isDrawing) return;

        const currentX = e.offsetX || e.touches[0].clientX - canvas.offsetLeft;
        const currentY = e.offsetY || e.touches[0].clientY - canvas.offsetTop;

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(currentX, currentY);
        ctx.strokeStyle = penColor;
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';
        ctx.stroke();

        lastX = currentX;
        lastY = currentY;

        enableSaveButton();
    }

    // Update pen color
    document.getElementById('colorPicker').addEventListener('change', (e) => {
        penColor = e.target.value;
    });

    // Clear the canvas
    function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        document.getElementById('message').textContent = '';
        disableSaveButton();
    }

    // Save the signature
    function saveSignature() {
        const imageData = canvas.toDataURL('image/png');
        
        if (imageData === "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA..." || canvas.width === 0 || canvas.height === 0) {
            document.getElementById('message').textContent = 'Tanda tangan tidak boleh kosong! Silakan gambar terlebih dahulu.';
            return;
        }

        const link = document.createElement('a');
        link.href = imageData;
        link.download = 'signature.png';
        link.click();
    }

    // Enable the save button
    function enableSaveButton() {
        saveButton.disabled = false;
        saveButton.classList.add('enabled');
    }

    // Disable the save button
    function disableSaveButton() {
        saveButton.disabled = true;
        saveButton.classList.remove('enabled');
    }

    // Add mouse and touch event listeners
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseleave', stopDrawing);

    canvas.addEventListener('touchstart', startDrawing);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', stopDrawing);
    canvas.addEventListener('touchcancel', stopDrawing);
</script>

</body>
</html>
